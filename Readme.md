

---

## Workflow

1. `dataSummary.py`  stat data and overview classification
    data downloader 
    
2. `dataGenerator.py`  
   generate classification data from folder structure into a single json file
   partConverter.py: use FreeCAD python API to convert step into brep
   OccQt: generate geometry metadata and dump views into images

2. `dataCollector.py`  
   resize and merge images (opencv2) into numpy.array 
   json meta files into pandas DF

3. `partClassify.py`: TensorFlow model mixed data (images, category data)

### debug tensorflow

https://www.tensorflow.org/tensorboard/debugger_v2

`tf.debugging.enable_check_numerics`


### improve accuracy

[The History Began from AlexNet: A Comprehensive Survey on Deep Learning Approaches]
> 2012 the error for AlexNet model using ImageNet data is 16.4%

1. adjust model parameter: like output layer, CNN layer parameters
2. use different image generator!
3. numeric parameters

### Data augmentation to prevent overfitting 

https://my.oschina.net/u/4067628/blog/4767106
flip,  must have
在 OpenCV 中 flip 函数的参数有 1 水平翻转、0 垂直翻转、-1 水平垂直翻转三种。 

shift: change edge
rotate,  not necessary oriented
```py
cv2.getRotationMatrix2D((center_x, center_y) , angle, 1.0)newimg = cv2.warpAffine(img, rotMat, (width, height))
newimg = cv2.warpAffine(img, rotMat, (width, height))
```
noise:


https://www.pyimagesearch.com/2019/02/04/keras-multiple-inputs-and-mixed-data/

https://analyticsindiamag.com/multi-label-image-classification-with-tensorflow-keras/
```py
from tensorflow.keras.preprocessing.image import ImageDataGenerator

train_dataGen = ImageDataGenerator(rescale = 1./255,
                                  shear_range = 0.2,
                                  zoom_range = 0.2,
                                  horizontal_flip = True)

train_generator = train_dataGen.flow_from_dataframe(
                                        dataframe = training_set,
                                        directory="",x_col="Images",
                                        y_col="New_class",
                                        class_mode="categorical",
                                        target_size=(128,128),
                                        batch_size=32)
```


### Geometrical properties: generated by occQt
name of the part
solid count
characteristics length, 2 length ratios. OBB  boundbox
volume/boundbox_volume
volume, area, perimeter,

## occQt:  image generation from geometry view

views are orth, along OBB


## Image compression: done in C++
cppyy `imagePreprocessing.py`
image size, for assembly level product like bearing, or complex part like gear

bolt are standard, geometry hashing ()
surface uid + collisionType matrix, can be used to merge in parallel.
surface uid, first bit are solid uid

how to check deadlock

random shake, pixpix
square pixels block, instead of line
image compressing 4, 8X8 (unit64_t -> double/float32 [0, 1] or [-1, 1]),  also avoid pooling
normalized to float32 or float64

G-function, C to accelerate

## deep learning model
mixed image and data input
flatten vertical, horizontal?
visual of tensor flow

## tensorflow test data
MNIST, 28X28 pixel grayscale



## comparison study

### compressed image, vs not compressed

bit compression, 

###  wireframe or normal for topology recognition

can be done,

### different image resolution, 

quick enough by threading

image pixel is not fixed, why?

scale to aspect ratio 1:1

### using geometry meta data only or images only


## Conclusion


## References